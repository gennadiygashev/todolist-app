{"ast":null,"code":"var _jsxFileName = \"/Users/gg/Documents/portfolio/proj-react/src/components/Card/Card.js\";\nimport React, { useState, useEffect } from 'react';\nimport Task from '../UI/Task/Task';\nimport AddTask from '../UI/AddTask/AddTask';\nimport CardTitle from './CardTitle/CardTitle';\nimport Axios from '../../axios/axios-folders';\nimport DeleteCard from '../UI/DeleteCard/DeleteCard';\nimport CardHeader from '@material-ui/core/CardHeader';\nimport CardContent from '@material-ui/core/CardContent';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Card from '@material-ui/core/Card';\nexport default function CardT(props) {\n  const [data, setData] = useState({\n    tasks: []\n  });\n  const [loading, setLoading] = useState(true);\n  const [emptyCard, setEmptyCard] = useState({\n    tasks: [{\n      name: 'Добавить новую задачу',\n      important: false,\n      done: false,\n      key: 'emptyCard'\n    }]\n  });\n\n  const createTask = name => {\n    return {\n      name,\n      important: false,\n      done: false,\n      key: ''\n    };\n  };\n\n  const onCompleteEmptyCard = taskID => {\n    setEmptyCard(({\n      tasks\n    }) => {\n      return {\n        tasks: toggleProperty(tasks, taskID, 'done')\n      };\n    });\n  };\n\n  const onToggleImportantEmptyCard = taskID => {\n    const oldItem = data.tasks[idx];\n    const newItem = { ...oldItem,\n      ['important']: !oldItem['important']\n    };\n    const activeFolderKey = props.activeFolderKey;\n    const cardKey = props.cardID;\n    const taskKey = taskID;\n    Axios.patch(`/folders/${activeFolderKey}/cards/${cardKey}/tasks/${taskKey}.json`, {\n      'important': newItem.important\n    });\n    setData(({\n      tasks\n    }) => {\n      return {\n        tasks: toggleProperty(tasks, taskID, 'important')\n      };\n    });\n  };\n\n  const addTask = async text => {\n    const newTask = createTask(text);\n    const activeFolderKey = props.activeFolderKey;\n    const cardKey = props.cardID;\n    await Axios.post(`/folders/${activeFolderKey}/cards/${cardKey}/tasks.json`, newTask).then(function (res) {\n      const taskKey = Object.values(res.data)[0];\n      newTask.key = taskKey;\n      Axios.patch(`/folders/${activeFolderKey}/cards/${cardKey}/tasks/${taskKey}.json`, {\n        'key': taskKey\n      });\n    });\n    setData(({\n      tasks\n    }) => {\n      const newArr = [...tasks, newTask];\n      return {\n        tasks: newArr\n      };\n    });\n  };\n\n  const deleteTask = taskID => {\n    console.log(taskID);\n    console.log(data.tasks);\n    const idx = data.tasks.findIndex(el => el.key === taskID);\n    console.log(idx);\n    const activeFolderKey = props.activeFolderKey;\n    const cardKey = props.cardID;\n    Axios.delete(`/folders/${activeFolderKey}/cards/${cardKey}/tasks/${taskID}.json`);\n    setData(({\n      tasks\n    }) => {\n      const newArr = [...tasks.slice(0, idx), ...tasks.slice(idx + 1)];\n      console.log(newArr);\n      return {\n        tasks: newArr\n      };\n    });\n  };\n\n  const toggleProperty = (arr, taskID, propName) => {\n    const idx = arr.findIndex(el => el.key === taskID);\n    const oldItem = arr[idx];\n    const newItem = { ...oldItem,\n      [propName]: !oldItem[propName]\n    };\n    return [...arr.slice(0, idx), newItem, ...arr.slice(idx + 1)];\n  };\n\n  const onToggleImportant = taskID => {\n    const idx = data.tasks.findIndex(el => el.key === taskID);\n    const oldItem = data.tasks[idx];\n    const newItem = { ...oldItem,\n      ['important']: !oldItem['important']\n    };\n    const activeFolderKey = props.activeFolderKey;\n    const cardKey = props.cardID;\n    const taskKey = taskID;\n    Axios.patch(`/folders/${activeFolderKey}/cards/${cardKey}/tasks/${taskKey}.json`, {\n      'important': newItem.important\n    });\n    setData(({\n      tasks\n    }) => {\n      return {\n        tasks: toggleProperty(tasks, taskID, 'important')\n      };\n    });\n  };\n\n  const onComplete = taskID => {\n    const idx = data.tasks.findIndex(el => el.key === taskID);\n    const oldItem = data.tasks[idx];\n    const newItem = { ...oldItem,\n      ['done']: !oldItem['done']\n    };\n    const activeFolderKey = props.activeFolderKey;\n    const cardKey = props.cardID;\n    const taskKey = taskID;\n    Axios.patch(`/folders/${activeFolderKey}/cards/${cardKey}/tasks/${taskKey}.json`, {\n      'done': newItem.done\n    });\n    setData(({\n      tasks\n    }) => {\n      return {\n        tasks: toggleProperty(tasks, taskID, 'done')\n      };\n    });\n  };\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const cardKey = props.cardID;\n        const activeFolderKey = props.activeFolderKey;\n        const responseTasks = await Axios.get(`/folders/${activeFolderKey}/cards/${cardKey}/tasks.json`);\n        const tasks = [];\n        Object.values(responseTasks.data).forEach(task => {\n          tasks.push(task);\n        });\n        setData({\n          tasks\n        });\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    const renderData = async () => {\n      await fetchData();\n      setLoading(false);\n    };\n\n    renderData();\n  }, []);\n  return /*#__PURE__*/React.createElement(Card, {\n    style: {\n      minHeight: '83vh',\n      height: '100%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(CardHeader, {\n    title: /*#__PURE__*/React.createElement(CardTitle, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 16\n      }\n    }),\n    action: /*#__PURE__*/React.createElement(DeleteCard, {\n      deleteCard: props.onDeleteCard,\n      cardID: props.cardID,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 11\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(CardContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 7\n    }\n  }, loading ? /*#__PURE__*/React.createElement(CircularProgress, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 20\n    }\n  }) : /*#__PURE__*/React.createElement(React.Fragment, null, data.tasks.length === 0 ? emptyCard.tasks.map(task => {\n    return /*#__PURE__*/React.createElement(Task, {\n      name: task.name,\n      important: task.important,\n      done: task.done,\n      key: task.key,\n      taskID: task.key,\n      onToggleImportant: onToggleImportantEmptyCard,\n      onDeleted: null,\n      onComplete: onCompleteEmptyCard,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 17\n      }\n    });\n  }) : data.tasks.map(task => {\n    return /*#__PURE__*/React.createElement(Task, {\n      name: task.name,\n      important: task.important,\n      done: task.done,\n      key: task.key,\n      taskID: task.key,\n      onToggleImportant: onToggleImportant,\n      onDeleted: deleteTask,\n      onComplete: onComplete,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 17\n      }\n    });\n  })), /*#__PURE__*/React.createElement(AddTask, {\n    text: \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0437\\u0430\\u0434\\u0430\\u0447\\u0443\",\n    onItemAdded: addTask,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 9\n    }\n  })));\n}","map":{"version":3,"sources":["/Users/gg/Documents/portfolio/proj-react/src/components/Card/Card.js"],"names":["React","useState","useEffect","Task","AddTask","CardTitle","Axios","DeleteCard","CardHeader","CardContent","CircularProgress","Card","CardT","props","data","setData","tasks","loading","setLoading","emptyCard","setEmptyCard","name","important","done","key","createTask","onCompleteEmptyCard","taskID","toggleProperty","onToggleImportantEmptyCard","oldItem","idx","newItem","activeFolderKey","cardKey","cardID","taskKey","patch","addTask","text","newTask","post","then","res","Object","values","newArr","deleteTask","console","log","findIndex","el","delete","slice","arr","propName","onToggleImportant","onComplete","fetchData","responseTasks","get","forEach","task","push","e","renderData","minHeight","height","onDeleteCard","length","map"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport Task from '../UI/Task/Task'\nimport AddTask from '../UI/AddTask/AddTask'\nimport CardTitle from './CardTitle/CardTitle';\nimport Axios from '../../axios/axios-folders';\nimport DeleteCard from '../UI/DeleteCard/DeleteCard';\nimport CardHeader from '@material-ui/core/CardHeader';\nimport CardContent from '@material-ui/core/CardContent';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Card from '@material-ui/core/Card';\n\n\nexport default function CardT(props) {\n\n  const [data, setData] = useState({ tasks: [] })\n  const [loading, setLoading] = useState(true)\n  const [emptyCard, setEmptyCard] = useState({ tasks: [{\n    name: 'Добавить новую задачу',\n    important: false,\n    done: false,\n    key: 'emptyCard'\n  }] })\n\n  const createTask = (name) => {\n    return {\n      name,\n      important: false,\n      done: false,\n      key: ''\n    }\n  }\n\n  const onCompleteEmptyCard = (taskID) => {\n    setEmptyCard(({ tasks }) => {\n      return {\n        tasks: toggleProperty(tasks, taskID, 'done')\n      }\n    })\n  }\n\n  const onToggleImportantEmptyCard = (taskID) => {\n    const oldItem = data.tasks[idx];\n    const newItem = {...oldItem,\n      ['important']: !oldItem['important']\n    }\n    const activeFolderKey = props.activeFolderKey\n    const cardKey = props.cardID\n    const taskKey = taskID\n    Axios.patch(`/folders/${activeFolderKey}/cards/${cardKey}/tasks/${taskKey}.json`, {'important': newItem.important})\n    setData(({ tasks }) => {\n      return {\n        tasks: toggleProperty(tasks, taskID, 'important')\n      }\n    })\n  }\n\n  const addTask = async (text) => {\n    const newTask = createTask(text);\n    const activeFolderKey = props.activeFolderKey\n    const cardKey = props.cardID\n    await Axios.post(`/folders/${activeFolderKey}/cards/${cardKey}/tasks.json`, newTask)\n    .then(function (res) {\n      const taskKey = ((Object.values(res.data))[0])\n      newTask.key = taskKey\n      Axios.patch(`/folders/${activeFolderKey}/cards/${cardKey}/tasks/${taskKey}.json`, {'key': taskKey})\n    })\n    setData(({ tasks }) => {\n      const newArr = [\n        ...tasks,\n        newTask\n      ];\n      return {\n        tasks: newArr\n      }\n    })\n  }\n\n  const deleteTask = (taskID) => {\n    console.log(taskID)\n    console.log(data.tasks)\n    const idx = data.tasks.findIndex((el) => el.key === taskID)\n    console.log(idx)\n    const activeFolderKey = props.activeFolderKey\n    const cardKey = props.cardID\n    Axios.delete(`/folders/${activeFolderKey}/cards/${cardKey}/tasks/${taskID}.json`)\n    setData(({ tasks }) => {\n      const newArr = [\n        ...tasks.slice(0, idx),\n        ...tasks.slice(idx + 1)\n      ]\n      console.log(newArr)\n      return {\n        tasks: newArr\n      }\n    })\n  }\n\n  const toggleProperty = (arr, taskID, propName) => {\n    const idx = arr.findIndex((el) => el.key === taskID);\n\n    const oldItem = arr[idx];\n    const newItem = {...oldItem,\n      [propName]: !oldItem[propName]}\n\n    return [\n      ...arr.slice(0, idx),\n      newItem,\n      ...arr.slice(idx + 1)\n    ]\n  }\n\n  const onToggleImportant = (taskID) => {\n    const idx = data.tasks.findIndex((el) => el.key === taskID);\n    const oldItem = data.tasks[idx];\n    const newItem = {...oldItem,\n      ['important']: !oldItem['important']\n    }\n    const activeFolderKey = props.activeFolderKey\n    const cardKey = props.cardID\n    const taskKey = taskID\n    Axios.patch(`/folders/${activeFolderKey}/cards/${cardKey}/tasks/${taskKey}.json`, {'important': newItem.important})\n    setData(({ tasks }) => {\n      return {\n        tasks: toggleProperty(tasks, taskID, 'important')\n      }\n    })\n  }\n\n  const onComplete = (taskID) => {\n    const idx = data.tasks.findIndex((el) => el.key === taskID);\n    const oldItem = data.tasks[idx];\n    const newItem = {...oldItem,\n      ['done']: !oldItem['done']\n    }\n    const activeFolderKey = props.activeFolderKey\n    const cardKey = props.cardID\n    const taskKey = taskID\n    Axios.patch(`/folders/${activeFolderKey}/cards/${cardKey}/tasks/${taskKey}.json`, {'done': newItem.done})\n    setData(({ tasks }) => {\n      return {\n        tasks: toggleProperty(tasks, taskID, 'done')\n      }\n    })\n  }\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {  \n        const cardKey = props.cardID\n        const activeFolderKey = props.activeFolderKey\n        const responseTasks = await Axios.get(`/folders/${activeFolderKey}/cards/${cardKey}/tasks.json`)\n        const tasks = []\n        Object.values(responseTasks.data).forEach((task) => {\n          tasks.push(task)\n        })  \n        setData({\n          tasks\n        }) \n      } catch (e) {\n        console.log(e)\n      }  \n    }\n    const renderData = async () => {\n      await fetchData()\n      setLoading(false)  \n    }\n    renderData()\n  }, [])\n\n  return (\n    <Card style={{ minHeight: '83vh', height: '100%' }}>\n      <CardHeader\n        title={<CardTitle />}\n        action={\n          <DeleteCard \n            deleteCard={props.onDeleteCard}\n            cardID={props.cardID}\n          />\n        }\n      />\n      <CardContent>\n        {loading ? <CircularProgress /> :\n          <>\n            {data.tasks.length === 0 ? \n            emptyCard.tasks.map((task) => {\n              return( \n                <Task\n                  name={task.name}\n                  important={task.important}\n                  done={task.done}\n                  key={task.key}\n                  taskID={task.key}\n                  onToggleImportant={onToggleImportantEmptyCard}\n                  onDeleted={null}\n                  onComplete={onCompleteEmptyCard}\n                />   \n              )                 \n            }) : \n            data.tasks.map((task) => {\n              return( \n                <Task\n                  name={task.name}\n                  important={task.important}\n                  done={task.done}\n                  key={task.key}\n                  taskID={task.key}\n                  onToggleImportant={onToggleImportant}\n                  onDeleted={deleteTask}\n                  onComplete={onComplete}\n                />   \n              )                 \n            })  \n            }\n          </>        \n        }\n        <AddTask text='Добавить задачу' onItemAdded={addTask} />\n      </CardContent>\n    </Card> \n  )\n}\n\n"]},"metadata":{},"sourceType":"module"}